<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Upload ke Google Drive</title>
</head>
<body>
  <h2>Upload File ke Google Drive</h2>
  
  <!-- Tombol login -->
  <button onclick="handleAuthClick()">Login dengan Google</button>
  <br><br>

  <!-- Input file -->
  <input type="file" id="fileInput">
  <button onclick="uploadFile()">Upload</button>

  <p id="status"></p>

  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    const CLIENT_ID = '1085850127078-m278l5fd1dkng3qdbjip9fanquthutuh.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyDqQgb2DS8tn8EwyZ30dF01oU2dIzVPKOw';
    const SCOPES = 'https://www.googleapis.com/auth/drive.file';

    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        scope: SCOPES
      });
    }

    function handleAuthClick() {
      gapi.auth2.getAuthInstance().signIn();
    }

    async function uploadFile() {
      const file = document.getElementById('fileInput').files[0];
      if (!file) {
        document.getElementById("status").innerText = "Pilih file terlebih dahulu.";
        return;
      }

      const accessToken = gapi.auth.getToken().access_token;

      const metadata = {
        name: file.name,
        mimeType: file.type
      };

      const form = new FormData();
      form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
      form.append('file', file);

      const res = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id', {
        method: 'POST',
        headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),
        body: form,
      });

      const result = await res.json();
      document.getElementById("status").innerText = "Upload berhasil! ID File: " + result.id;
    }

    handleClientLoad();
  </script>
</body>
</html>
